# -*- coding: utf-8 -*-
# vim: ft=yaml
#
# Setup variables using grains['os_family'] based logic.
# You just need to add the key:values for an `os_family` that differ
# from `defaults.yaml` + `osarch.yaml`.
# Only add an `os_family` which is/will be supported by the formula.
#
# If you do not need to provide defaults via the `os_family` grain,
# you will need to provide at least an empty dict in this file, e.g.
# osfamilymap: {}
---
Debian:
  config:
    servicename:
      isns: isnsd
  initiator:
    enabled: False  #see https://github.com/saltstack-formulas/iscsi-formula/issues/10
    pkgs:
      wanted:
        - open-iscsi
        - libiscsi-bin
  target:
    provider: tgtd
    pkgs:
      wanted:
        - tgt
        - istgt
        - thin-provisioning-tools
      unwanted:
        - iscsitarget
        - iscsitarget-dkms
        - infiniband-diags
        - ibutils
        - ibverbs-utils #not suse
        - rdmacm-utils  #not suse
        - perftest
RedHat:
  config:
    name:
      tgtd: /etc/tgt/targets.conf     #cent6
    servicename:
      open-iscsi: iscsi
      isns: isnsd
      tgtd: tgtd                      #cent6
  isns:
    pkgs:
      wanted:
        - isns-utils
        - yum-plugin-versionlock
        # target-isns
  initiator:
    pkgs:
      wanted:
        - iscsi-initiator-utils
           {%- if 'osmajorrrelease' in grains and grains.osmajorrelease >= 7 %}
        - iscsi-initiator-utils-iscsiuio
        - libiscsi
        - libiscsi-utils
           {%- endif %}
  target:
    pkgs:
      wanted:
        - device-mapper-persistent-data
           {%- if 'osmajorrrelease' in grains and grains.osmajorrelease == 6 %}
        - scsi-target-utils
        - fcoe-utils
        - fcoe-target-utils
           {%- elif 'osmajorrrelease' in grains and grains.osmajorrelease >= 7 %}
        - yum-plugin-versionlock
        - targetcli
        - libvirt-daemon-driver-storage-iscsi
               {%- if 'os' in grains and grains.os not in ('Amazon',) %}
        - netbsd-iscsi
        - udisks2-iscsi
               {%- endif %}
           {%- endif %}

Suse:
  config:
    servicename: 
      open-iscsi: iscsid
      lio: targetcli
  isns:
    pkgs:
      wanted:
        - open-isns
  initiator:
    pkgs:
      wanted:
        - open-iscsi
        - libiscsi8
        - librdmacm1
        - qemu-block-iscsi
        - iscsiuio
        - yast2-iscsi-client
  target:
    pkgs:
      wanted:
        - python3-configshell-fb
        - python3-pyudev
        - python3-rtslib-fb
        - python3-targetcli-fb
        - python3-urwid
        - targetcli-fb-common
        - libiscsi-utils
        - iscsiuio
        - yast2-iscsi-lio-server
        - qemu-block-iscsi
        - infiniband-diags
        - ibutils
        - perftest

Gentoo:
  target:
    pkgs:
      wanted:
        - sys-block/targetcli-fb
        # sys-block/tgt
  config:
    kmodule:
      lio: iscsi_tcp

Arch:
  config:
    servicename:
      open-iscsi:
       - iscsi
       - iscsid
  initiator:
    make:
      gitrepo: https://aur.archlinux.org
      cmd: makepkg -si --noconfirm -f
      wanted: []
  target:
    pkgs:
      wanted:
        - linux-lts                # For kernel scsi modules
        - python-pip               # makepkg states needs 'gitpython'.
        - thin-provisioning-tools
    make:
      gitrepo: https://aur.archlinux.org
      cmd: makepkg -si --noconfirm -f
      wanted:
        - python-rtslib-fb
        - python-configshell-fb
        - targetcli-fb

Alpine: {}

FreeBSD:
  rootgroup: wheel
  isns:
    pkgs:
      wanted:
        - net/open-isns
  target:
    provider: ctld
    pkgs:
      wanted:
        - net/istgt
  initiator:
    provider: iscsi
    pkgs:
      wanted: []
  config:
    name:
      modprobe: /boot/loader.conf
  kernel:
    modload: kldload
    modunload: kldunload
    modquery: kldstat -q -m

OpenBSD:
  rootgroup: wheel

Solaris: {}

Windows: {}

MacOS: {}
