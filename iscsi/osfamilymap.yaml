# -*- coding: utf-8 -*-
# vim: ft=yaml
#
# Setup variables using grains['os_family'] based logic.
# You just need to add the key:values for an `os_family` that differ
# from `defaults.yaml` + `osarch.yaml`.
# Only add an `os_family` which is/will be supported by the formula.
#
# If you do not need to provide defaults via the `os_family` grain,
# you will need to provide at least an empty dict in this file, e.g.
# osfamilymap: {}
---
Debian:
  config:
    servicename:
      isns: isnsd
  initiator:
    enabled: False  #see https://github.com/saltstack-formulas/iscsi-formula/issues/10
    pkgs:
      wanted:
        - open-iscsi
        - libiscsi-bin
  target:
    provider: tgtd
    pkgs:
      wanted:
        - tgt
        - istgt
        - thin-provisioning-tools
      unwanted:
        - iscsitarget
        - iscsitarget-dkms

RedHat:
  config:
    name:
     tgtd: /etc/tgt/targets.conf     #cent6
    servicename:
      open-iscsi: iscsi
      isns: isnsd
      tgtd: tgtd                     #cent6
  isns:
    pkgs:
      wanted:
        - isns-utils
        - yum-plugin-versionlock
        # target-isns                #fedora29
  initiator:
    pkgs:
      wanted:
        - iscsi-initiator-utils               #cent6/cent7/fedora/amazon
           {%- if grains.osmajorrelease >= 7 %}
        - iscsi-initiator-utils-iscsiuio      #cent7/fedora
        - libiscsi                            #cent7/fedora
        - libiscsi-utils                      #cent7/fedora
           {%- endif %}
  target:
    pkgs:
      wanted:
	- device-mapper-persistent-data                #cent6/cent7/fedora/amazon
           {%- if grains.osmajorrelease == 6 %}
        - scsi-target-utils                            #cent6/fedora
        - fcoe-utils                                   #cent6/fedora
        - fcoe-target-utils                            #cent6

           {%- elif grains.osmajorrelease >= 7 %}
        - yum-plugin-versionlock                       #cent6/cent7/fedora
        - targetcli                                    #cent7/fedora
        - libvirt-daemon-driver-storage-iscsi          #cent7/fedora

               {%- if grains.os not in ('Amazon',) %}
        - netbsd-iscsi                                 #cent6/cent7/fedora
        - udisks2-iscsi                                #cent7/fedora
               {%- endif %}
           {%- endif %}

Suse:
  config:
    servicename: 
      open-iscsi: iscsid
           {%- if grains.osmajorrelease >= 15  %}
      lio: targetcli
           {%- else %}
      lio: target
           {%- endif %}
  isns:
    pkgs:
      wanted:
        - open-isns
  initiator:
    pkgs:
      wanted:
        - open-iscsi
        - libiscsi8
        - librdmacm1
        - qemu-block-iscsi
        - iscsiuio
        - yast2-iscsi-client
  target:
    pkgs:
      wanted:
        - python3-configshell-fb
        - python3-pyudev
        - python3-rtslib-fb
        - python3-targetcli-fb
        - python3-urwid
        - targetcli-fb-common
        - libiscsi-utils
        - iscsiuio
        - yast2-iscsi-lio-server
        - qemu-block-iscsi

Gentoo:
  target:
    pkgs:
      wanted:
        - sys-block/targetcli-fb
        # sys-block/tgt
  config:
    kmodule:
      lio: iscsi_tcp

Arch:
  config:
    servicename:
      open-iscsi:
       - iscsi
       - iscsid
  initiator:
    make:
      gitrepo: https://aur.archlinux.org
      cmd: makepkg -si --noconfirm -f
      wanted: []
  target:
    pkgs:
      wanted:
        - linux-lts                # For kernel scsi modules
        - python-pip               # makepkg states needs 'gitpython'.
        - thin-provisioning-tools
    make:
      gitrepo: https://aur.archlinux.org
      cmd: makepkg -si --noconfirm -f
      wanted:
        - python-rtslib-fb
        - python-configshell-fb
        - targetcli-fb

Alpine: {}

FreeBSD:
  rootgroup: wheel
  isns:
    pkgs:
      wanted:
        - net/open-isns
  target:
    provider: ctld
    pkgs:
      wanted:
        - net/istgt
  initiator:
    provider: iscsi
    pkgs:
      wanted: []
  config:
    name:
      modprobe: /boot/loader.conf
  kernel:
    modload: kldload
    modunload: kldunload
    modquery: kldstat -q -m

OpenBSD:
  rootgroup: wheel

Solaris: {}

Windows: {}

MacOS: {}
